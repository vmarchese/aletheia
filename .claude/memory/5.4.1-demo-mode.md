# Session Memory - Task 5.4.1 Demo Mode

## Task Overview
Implement demo/test mode in CLI with pre-recorded responses and mocked data for manual testing of guided mode without real services.

**Status**: ✅ COMPLETE

**Worktree**: `worktrees/feat/5.4.1-demo-mode`
**Branch**: `feat/5.4.1-demo-mode`
**Commit**: `f987d3c`

## Implementation Summary

### What Was Implemented

#### 1. Demo Data Module ✅
Created `aletheia/demo/` with comprehensive pre-recorded data:
- **DemoDataProvider** (`demo/data.py`): Provides mock data for two scenarios
  - Kubernetes logs with realistic timestamps and error patterns
  - Prometheus metrics with anomaly patterns
  - Git blame information
  - Code context snippets
- **Demo Scenarios** (`demo/scenario.py`): Two complete investigation scenarios
  - Payment Service Crash (goroutine deadlock)
  - API Latency Spike (timeout misconfiguration)
- Each scenario includes:
  - Problem description
  - Data collection summary
  - Pattern analysis results
  - Code inspection findings
  - Final diagnosis with recommendations

#### 2. Mock Agent System ✅
Created four mock agents (`demo/agents.py`) that simulate real agent behavior:
- **MockDataFetcherAgent**: Returns pre-recorded data summaries
- **MockPatternAnalyzerAgent**: Returns pre-recorded pattern analysis
- **MockCodeInspectorAgent**: Returns pre-recorded code inspection
- **MockRootCauseAnalystAgent**: Returns pre-recorded diagnosis
- All agents write to scratchpad just like real agents
- All agents inherit from BaseAgent for consistency

#### 3. Demo Orchestrator ✅
Created `DemoOrchestrator` (`demo/orchestrator.py`) that:
- Manages full investigation workflow with mock agents
- Displays scenario information
- Shows progress through 4 phases (data collection, pattern analysis, code inspection, root cause analysis)
- Requests user confirmation between phases
- Displays results with Rich formatting
- Uses OutputFormatter for consistent UI

#### 4. Demo CLI Commands ✅
Added two new CLI commands:
- **`aletheia demo list`**: Lists all available demo scenarios
- **`aletheia demo run <scenario>`**: Runs a demo investigation
  - Uses temporary scratchpad (not persisted)
  - No LLM API calls needed
  - No real data sources needed
  - Full interactive experience

#### 5. Comprehensive Testing ✅
Created `tests/unit/test_demo.py` with 22 tests:
- **DemoDataProvider tests** (8 tests): Verify mock data generation
- **Demo Scenarios tests** (4 tests): Validate scenario structure
- **Mock Agents tests** (6 tests): Test all mock agents
- **Demo Orchestrator tests** (4 tests): Test workflow execution
- **Test Coverage**: 
  - `demo/data.py`: 94.29%
  - `demo/orchestrator.py`: 79.07%
  - `demo/agents.py`: Fully covered through orchestrator tests
- All tests passing ✅

### Key Features

1. **No External Dependencies**: Runs completely offline with pre-recorded data
2. **Realistic Experience**: Full guided mode workflow with actual UI
3. **Multiple Scenarios**: Two distinct investigation scenarios
4. **Interactive**: User can confirm/cancel at each phase
5. **Educational**: Shows complete investigation flow
6. **Test-Friendly**: Easy to add new scenarios

### Files Created

1. `aletheia/demo/__init__.py` - Module exports
2. `aletheia/demo/data.py` - Mock data provider (371 lines)
3. `aletheia/demo/scenario.py` - Scenario definitions (546 lines)
4. `aletheia/demo/agents.py` - Mock agents (195 lines)
5. `aletheia/demo/orchestrator.py` - Demo orchestrator (217 lines)
6. `tests/unit/test_demo.py` - Test suite (313 lines)
7. `.claude/memory/5.4.1-demo-mode.md` - This file

### Usage

```bash
# List available scenarios
aletheia demo list

# Run a demo scenario
aletheia demo run payment_service_crash
aletheia demo run api_latency_spike
```

### Next Steps

- ✅ Mark TODO step 5.4.1 as complete
- Document demo mode in README.md
- Consider adding more scenarios (database connection pool exhaustion, memory leak, etc.)

## Progress Log

### 2025-10-17 - Initial Setup
- Created worktree and branch
- Installed dependencies
- Reviewed existing CLI and orchestrator structure
- Created implementation plan

### 2025-10-17 - Implementation Complete
- Implemented DemoDataProvider with two scenarios
- Created scenario definitions with complete investigation flows
- Implemented 4 mock agents
- Created DemoOrchestrator
- Added CLI commands (demo list, demo run)
- Created comprehensive test suite (22 tests, all passing)
- Committed changes (commit: f987d3c)
